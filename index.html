<!DOCTYPE html>  <html lang="es">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>MI IA - Asistente Inteligente</title>  
    <style>  
        :root {  
            --primary: #667eea;  
            --secondary: #764ba2;  
            --bg-dark: #0f0f23;  
            --bg-card: #1a1a3e;  
            --border: #2a2a5e;  
            --text: #ffffff;  
            --text-dim: #aaa;  
        }  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }  

    body {  
        background: var(--bg-dark);  
        color: var(--text);  
        height: 100vh;  
        display: flex;  
        flex-direction: column;  
        overflow: hidden;  
    }  

    /* HEADER */  
    .header {  
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);  
        padding: 15px 20px;  
        display: flex;  
        justify-content: space-between;  
        align-items: center;  
        box-shadow: 0 4px 15px rgba(0,0,0,0.4);  
        z-index: 10;  
    }  

    .header h1 { font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }  

    .admin-btn {  
        background: rgba(255,255,255,0.15);  
        border: 1px solid rgba(255,255,255,0.3);  
        color: white;  
        padding: 8px 16px;  
        border-radius: 20px;  
        cursor: pointer;  
        font-size: 0.85em;  
        transition: 0.3s;  
    }  
    .admin-btn:hover { background: rgba(255,255,255,0.25); }  

    /* CHAT CONTAINER */  
    .chat-container {  
        flex: 1;  
        overflow-y: auto;  
        padding: 20px;  
        display: flex;  
        flex-direction: column;  
        gap: 20px;  
        scroll-behavior: smooth;  
    }  

    /* Mensajes */  
    .message {  
        max-width: 85%;  
        padding: 14px 18px;  
        border-radius: 18px;  
        line-height: 1.6;  
        animation: fadeIn 0.3s ease-out;  
        position: relative;  
        word-wrap: break-word;  
    }  

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }  

    .message.user {  
        align-self: flex-end;  
        background: linear-gradient(135deg, var(--primary), var(--secondary));  
        border-bottom-right-radius: 4px;  
    }  

    .message.bot {  
        align-self: flex-start;  
        background: var(--bg-card);  
        border: 1px solid var(--border);  
        border-bottom-left-radius: 4px;  
    }  

    .message .name {  
        font-size: 0.75rem;  
        font-weight: bold;  
        margin-bottom: 5px;  
        color: var(--primary);  
        display: block;  
    }  

    /* Markdown Styles */  
    pre {  
        background: #0a0a1a;  
        padding: 15px;  
        border-radius: 8px;  
        margin: 10px 0;  
        overflow-x: auto;  
        position: relative;  
    }  
    code { font-family: 'Consolas', monospace; font-size: 0.9em; }  
    .copy-code {  
        position: absolute;  
        right: 5px;  
        top: 5px;  
        background: var(--border);  
        border: none;  
        color: white;  
        padding: 4px 8px;  
        border-radius: 4px;  
        font-size: 0.7em;  
        cursor: pointer;  
    }  

    /* INPUT AREA */  
    .input-area {  
        padding: 20px;  
        background: var(--bg-card);  
        border-top: 1px solid var(--border);  
    }  

    .input-wrapper {  
        max-width: 900px;  
        margin: 0 auto;  
        display: flex;  
        gap: 12px;  
        align-items: flex-end;  
    }  

    textarea {  
        flex: 1;  
        background: var(--bg-dark);  
        border: 1px solid var(--border);  
        color: white;  
        padding: 12px 18px;  
        border-radius: 24px;  
        resize: none;  
        max-height: 150px;  
        outline: none;  
        transition: 0.2s;  
    }  

    textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(102,126,234,0.2); }  

    .send-btn {  
        background: linear-gradient(135deg, var(--primary), var(--secondary));  
        border: none;  
        width: 48px;  
        height: 48px;  
        border-radius: 50%;  
        cursor: pointer;  
        color: white;  
        font-size: 1.2rem;  
        transition: 0.3s;  
        flex-shrink: 0;  
    }  

    .send-btn:hover:not(:disabled) { transform: scale(1.1); }  
    .send-btn:disabled { opacity: 0.5; filter: grayscale(1); }  

    /* MODALES */  
    .modal-overlay {  
        display: none;  
        position: fixed;  
        top:0; left:0; width:100%; height:100%;  
        background: rgba(0,0,0,0.8);  
        z-index: 100;  
        justify-content: center;  
        align-items: center;  
        backdrop-filter: blur(5px);  
    }  
    .modal-overlay.active { display: flex; }  
    .modal {  
        background: var(--bg-card);  
        padding: 30px;  
        border-radius: 20px;  
        width: 90%;  
        max-width: 500px;  
        border: 1px solid var(--border);  
    }  
    .modal input, .modal select, .modal textarea {  
        width: 100%; background: var(--bg-dark); border: 1px solid var(--border);  
        color: white; padding: 10px; border-radius: 8px; margin-top: 10px;  
    }  
    .save-btn {  
        width: 100%; padding: 12px; margin-top: 20px; border: none;  
        border-radius: 10px; background: var(--primary); color: white;  
        font-weight: bold; cursor: pointer;  
    }  

    /* WELCOME SCREEN */  
    .welcome { text-align: center; margin: auto; max-width: 500px; }  
    .suggestions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 20px; }  
    .suggestions button {  
        background: var(--bg-card); border: 1px solid var(--border); color: var(--text-dim);  
        padding: 8px 15px; border-radius: 15px; cursor: pointer; transition: 0.3s;  
    }  
    .suggestions button:hover { background: var(--primary); color: white; }  
</style>

</head>  
<body>  <div class="header">  
    <h1 onclick="location.reload()" style="cursor:pointer">ü§ñ <span id="botNameHeader">MI IA</span></h1>  
    <button class="admin-btn" onclick="openAdminLogin()">‚öôÔ∏è Configurar</button>  
</div>  <div class="chat-container" id="chatContainer">  
    <div class="welcome" id="welcome">  
        <div style="font-size: 4rem; margin-bottom: 20px;">üöÄ</div>  
        <h2 id="welcomeName">Bienvenido</h2>  
        <p style="color: var(--text-dim)">Soy tu asistente personal potenciado con IA. ¬øEn qu√© puedo ayudarte hoy?</p>  
        <div class="suggestions">  
            <button onclick="sendSuggestion('Dame una receta saludable')">ü•ó Receta</button>  
            <button onclick="sendSuggestion('¬øC√≥mo funciona la computaci√≥n cu√°ntica?')">‚öõÔ∏è Ciencia</button>  
            <button onclick="sendSuggestion('Escribe un c√≥digo en Python para leer un CSV')">üêç Python</button>  
        </div>  
    </div>  
</div>  <div class="input-area">  
    <div class="input-wrapper">  
        <textarea id="userInput" placeholder="Escribe un mensaje..." rows="1" onkeydown="handleKey(event)"></textarea>  
        <button id="sendBtn" class="send-btn" onclick="sendMessage()">‚û§</button>  
    </div>  
</div>  <!-- LOGIN MODAL -->  <div class="modal-overlay" id="loginModal">  
    <div class="modal">  
        <h2>Acceso Admin</h2>  
        <input type="password" id="adminPassword" placeholder="Contrase√±a">  
        <button class="save-btn" onclick="adminLogin()">Entrar</button>  
    </div>  
</div>  <!-- ADMIN MODAL -->  <div class="modal-overlay" id="adminModal">  
    <div class="modal" style="max-height: 90vh; overflow-y: auto;">  
        <h2>‚öôÔ∏è Configuraci√≥n</h2>  
        <label>Nombre del Bot</label><input type="text" id="cfgBotName">  
        <label>Groq API Key</label><input type="password" id="cfgApiKey">  
        <label>Personalidad (System Prompt)</label><textarea id="cfgSystemPrompt"></textarea>  
        <label>Modelo</label>  
        <select id="cfgModel">  
            <option value="llama3-8b-8192">Llama 3 8B (R√°pido)</option>  
            <option value="llama3-70b-8192">Llama 3 70B (Inteligente)</option>  
            <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>  
        </select>  
        <button class="save-btn" onclick="saveAdmin()">Guardar Cambios</button>  
        <button onclick="clearChat()" style="background:#e74c3c; width:100%; margin-top:10px; border:none; padding:10px; border-radius:10px; color:white; cursor:pointer;">Borrar Todo el Historial</button>  
    </div>  
</div>  <script>  
    let CONFIG = {  
        apiKey: '',  
        model: 'llama3-8b-instant',  
        botName: 'MI IA',  
        systemPrompt: 'Eres un asistente √∫til y conciso. Responde siempre en espa√±ol.',  
        temperature: 0.7,  
        adminPassword: 'admin',  
        messages: [] // Aqu√≠ guardamos el historial  
    };  
  
    // --- CARGA INICIAL ---  
    window.onload = () => {  
        const saved = localStorage.getItem('ia_pro_config');  
        if (saved) {  
            CONFIG = { ...CONFIG, ...JSON.parse(saved) };  
            renderHistory();  
        }  
        updateUI();  
    };  
  
    function updateUI() {  
        document.getElementById('botNameHeader').textContent = CONFIG.botName;  
        document.getElementById('welcomeName').textContent = "Habla con " + CONFIG.botName;  
    }  
  
    function renderHistory() {  
        if (CONFIG.messages.length > 0) {  
            document.getElementById('welcome').style.display = 'none';  
            CONFIG.messages.forEach(msg => {  
                appendMessageToUI(msg.role === 'user' ? 'user' : 'bot', msg.content);  
            });  
        }  
    }  
  
    // --- L√ìGICA DE CHAT ---  
    async function sendMessage() {  
        const input = document.getElementById('userInput');  
        const text = input.value.trim();  
          
        if (!text) return;  
        if (!CONFIG.apiKey) return alert("Por favor, configura tu API Key en el panel de Admin.");  
  
        // UI Update  
        document.getElementById('welcome').style.display = 'none';  
        appendMessageToUI('user', text);  
        input.value = '';  
        input.style.height = '48px';  
  
        // Agregar al historial  
        CONFIG.messages.push({ role: 'user', content: text });  
          
        const typingId = showTyping();  
  
        try {  
            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {  
                method: 'POST',  
                headers: {  
                    'Authorization': `Bearer ${CONFIG.apiKey}`,  
                    'Content-Type': 'application/json'  
                },  
                body: JSON.stringify({  
                    model: CONFIG.model,  
                    messages: [  
                        { role: 'system', content: CONFIG.systemPrompt },  
                        ...CONFIG.messages.slice(-10) // Enviamos √∫ltimos 10 mensajes  
                    ],  
                    temperature: CONFIG.temperature  
                })  
            });  
  
            const data = await response.json();  
            removeTyping(typingId);  
  
            if (data.choices) {  
                const botMsg = data.choices[0].message.content;  
                CONFIG.messages.push({ role: 'assistant', content: botMsg });  
                appendMessageToUI('bot', botMsg);  
                saveData();  
            } else {  
                throw new Error(data.error?.message || "Error desconocido");  
            }  
        } catch (e) {  
            removeTyping(typingId);  
            appendMessageToUI('bot', "‚ùå Error: " + e.message);  
        }  
    }  
  
    function appendMessageToUI(type, text) {  
        const container = document.getElementById('chatContainer');  
        const div = document.createElement('div');  
        div.className = `message ${type}`;  
          
        const content = type === 'bot' ?   
            `<span class="name">ü§ñ ${CONFIG.botName}</span>${formatMarkdown(text)}` :   
            text;  
          
        div.innerHTML = content;  
        container.appendChild(div);  
        container.scrollTop = container.scrollHeight;  
    }  
  
    // --- FORMATEO ---  
    function formatMarkdown(text) {  
        // Bloques de c√≥digo  
        text = text.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {  
            return `<pre><button class="copy-code" onclick="copyCode(this)">Copiar</button><code>${code.trim()}</code></pre>`;  });  
    // Negritas  
    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');  
    // Listas  
    text = text.replace(/^\s*-\s(.*)/gm, '<li>$1</li>');  
    text = text.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');  
    // Saltos de l√≠nea  
    return text.replace(/\n/g, '<br>');  
}  

function copyCode(btn) {  
    const code = btn.nextElementSibling.innerText;  
    navigator.clipboard.writeText(code);  
    btn.innerText = "¬°Copiado!";  
    setTimeout(() => btn.innerText = "Copiar", 2000);  
}  

// --- UTILS ---  
function showTyping() {  
    const id = 't-' + Date.now();  
    const div = document.createElement('div');  
    div.id = id;  
    div.className = 'message bot';  
    div.innerHTML = '<i>Escribiendo...</i>';  
    document.getElementById('chatContainer').appendChild(div);  
    document.getElementById('sendBtn').disabled = true;  
    return id;  
}  

function removeTyping(id) {  
    const el = document.getElementById(id);  
    if (el) el.remove();  
    document.getElementById('sendBtn').disabled = false;  
}  

function handleKey(e) {  
    if (e.key === 'Enter' && !e.shiftKey) {  
        e.preventDefault();  
        sendMessage();  
    }  
    e.target.style.height = 'auto';  
    e.target.style.height = e.target.scrollHeight + 'px';  
}  

function sendSuggestion(text) {  
    document.getElementById('userInput').value = text;  
    sendMessage();  
}  

// --- ADMIN ---  
function openAdminLogin() {  
    document.getElementById('loginModal').classList.add('active');  
}  

function adminLogin() {  
    if (document.getElementById('adminPassword').value === CONFIG.adminPassword) {  
        document.getElementById('loginModal').classList.remove('active');  
        openAdminPanel();  
    } else alert("Error");  
}  

function openAdminPanel() {  
    document.getElementById('cfgBotName').value = CONFIG.botName;  
    document.getElementById('cfgApiKey').value = CONFIG.apiKey;  
    document.getElementById('cfgSystemPrompt').value = CONFIG.systemPrompt;  
    document.getElementById('cfgModel').value = CONFIG.model;  
    document.getElementById('adminModal').classList.add('active');  
}  

function saveAdmin() {  
    CONFIG.botName = document.getElementById('cfgBotName').value;  
    CONFIG.apiKey = document.getElementById('cfgApiKey').value;  
    CONFIG.systemPrompt = document.getElementById('cfgSystemPrompt').value;  
    CONFIG.model = document.getElementById('cfgModel').value;  
    saveData();  
    updateUI();  
    document.getElementById('adminModal').classList.remove('active');  
}  

function clearChat() {  
    if (confirm("¬øSeguro? Se borrar√° todo el historial.")) {  
        CONFIG.messages = [];  
        saveData();  
        location.reload();  
    }  
}  

function saveData() {  
    localStorage.setItem('ia_pro_config', JSON.stringify(CONFIG));  
}  

// Cerrar modales clic fuera  
window.onclick = (e) => {  
    if (e.target.className === 'modal-overlay active') {  
        e.target.classList.remove('active');  
    }  
}

</script>  
</body>  
</html>w
